function Simulation(){var d=null;var c=(function(){var k={gridSize:150,behavior:l()[0],orientationIndex:0,intervalCount:1,milliseconds:0},h;function l(){if(h!=undefined){return h}h=[{turns:"RL".split(""),colors:["#5f5","#f55"]},{turns:"RLR".split(""),colors:j(3)},{turns:"LLRR".split(""),colors:j(4)},{turns:"RLLR".split(""),colors:j(4)},{turns:"LRRRRRLLR".split(""),colors:j(9)},{turns:"LLRRRLRLRLLR".split(""),colors:j(12)},{turns:"RRLLLRLLLRRR".split(""),colors:j(12)}];return h}function j(r){var o=[];for(var p=0;p<r;p++){var n=m(q());o.push(n)}function q(){var u="0123456789ABCDEF".split("");var s="#";for(var t=0;t<6;t++){s+=u[Math.floor(Math.random()*16)]}return s}function m(u){for(var t=0,s=o.length;t<s;t++){if(o[t]==u){m(q())}}return u}return o}(function i(){var n=l();var r=document.getElementById("behaviors");for(var s=0,m=n.length;s<m;s++){var q="";for(var p=0,o=n[s].turns.length;p<o;p++){q+=n[s].turns[p]}r.appendChild(new Option(q,s))}r.appendChild(new Option("Custom",-1))})();return{setGridSize:function(m){k.gridSize=parseInt(m)},setAntBehavior:function(m){k.behavior=l()[parseInt(m)]},setCustomAntBehavior:function(n){var m=n.split("");k.behavior={turns:m,colors:j(m.length)}},setAntOrientation:function(m){k.orientationIndex=parseInt(m)},setRefreshInterval:function(m){k.intervalCount=parseInt(m)},setRefreshDelayInterval:function(m){k.milliseconds=parseInt(m)},get:k}})();var b=(function(){var k=document.getElementById("displayAntBehavior");var h=document.getElementById("iterationCount");var j=document.getElementById("theBoard");var i=j.getContext("2d");var n=8;var m=0.5;var l=[[{x:-1,y:0},{x:0,y:-1},{x:1,y:0}],[{x:0,y:-1},{x:1,y:0},{x:0,y:1}],[{x:-1,y:0},{x:0,y:1},{x:1,y:0}],[{x:0,y:-1},{x:-1,y:0},{x:0,y:1}]];return{setCanvasSize:function(o){j.width=o;j.height=o},clearCanvas:function(){i.clearRect(0,0,j.width,j.height)},printGrid:function(){var p=(c.get.gridSize*n)+(n*2);this.setCanvasSize(p);for(var o=m;o<p;o+=n){i.moveTo(o,0);i.lineTo(o,p-n)}for(var q=m;q<p;q+=n){i.moveTo(0,q);i.lineTo(p-n,q)}i.strokeStyle="#555";i.stroke()},printCellState:function(q){var o=(g.x*n)+1,r=(g.y*n)+1,p=n-1;i.fillStyle=c.get.behavior.colors[q];i.fillRect(o,r,p,p)},printIterationCount:function(o){h.innerText=o.toLocaleString()},clearIterationCount:function(){h.innerText="0"},printAntOrientation:function(){var p=(g.x*n)+m+(n/2),o=(g.y*n)+m+(n/2),q=l[g.orientation];i.fillStyle="#000";i.beginPath();i.moveTo(p+q[0].x,o+q[0].y);i.lineTo(p+q[1].x,o+q[1].y);i.lineTo(p+q[2].x,o+q[2].y);i.fill()},printBehaviorAlgorithm:function(r){var q="";for(var p=0,o=r.turns.length;p<o;p++){q+='<span class="behavior" style="background-color:'+r.colors[p]+' !important;"><img src="img/'+r.turns[p]+'.png" alt="'+r.turns[p]+'"/></span>'}k.innerHTML=q},clearBehaviorAlgorithm:function(){k.innerHTML=""}}})();var a={init:function(){this.cells=new Int8Array(c.get.gridSize+(c.get.gridSize*c.get.gridSize));b.clearCanvas();b.printGrid()},getCellState:function(h){return this.cells[h]},setCellState:function(h,i){this.cells[h]=i}};var g={init:function(){this.x=Math.floor(c.get.gridSize/2);this.y=Math.floor(c.get.gridSize/2);this.orientation=c.get.orientationIndex;this.cellIndex=this.y+this.x*c.get.gridSize},turn:function(h){if(c.get.behavior.turns[h]==="R"){this.orientation=(this.orientation+5)%4}else{this.orientation=(this.orientation+3)%4}},move:function(){if(!(this.orientation%2)){this.y+=this.orientation-1}else{this.x-=this.orientation-2}this.cellIndex=this.y+this.x*c.get.gridSize}};function f(){e();d=setInterval(i,c.get.milliseconds);b.printBehaviorAlgorithm(c.get.behavior);function i(){var l=0;for(var k=0,j=c.get.intervalCount;k<j;k++){if(h()){clearInterval(d);b.printIterationCount(l);break}l++}b.printIterationCount(l)}function h(){var k=a.getCellState(g.cellIndex);var j=(k+1)%c.get.behavior.colors.length;a.setCellState(g.cellIndex,j);b.printCellState(k);b.printAntOrientation();g.turn(k);g.move();if(g.cellIndex<0||g.cellIndex>a.cells.length){return true}}}function e(){clearInterval(d);b.clearBehaviorAlgorithm();b.clearIterationCount();a.init();g.init()}return{run:f,reset:e,Options:c}};